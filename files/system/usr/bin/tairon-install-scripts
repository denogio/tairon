#!/usr/bin/env bash
# Install Tairon scripts to ~/.local/bin
# This script runs on first boot to set up all Tairon utilities

set -euo pipefail

# Source gum for pretty output
command -v gum &> /dev/null || {
    echo "gum not found, using basic output"
}

TARGET_DIR="$HOME/.local/bin"
SOURCE_DIR="/usr/lib/tairon-scripts"

gum style --foreground 212 "Installing Tairon scripts to $TARGET_DIR..."
echo ""

# Ensure target directory exists
mkdir -p "$TARGET_DIR"

# Copy all scripts
gum spin --spinner dot --title "Copying Tairon scripts..." -- cp -r "$SOURCE_DIR"/* "$TARGET_DIR/"

# Make them executable
chmod +x "$TARGET_DIR"/tairon-*

# Show what was installed
INSTALLED_COUNT=$(ls "$TARGET_DIR"/tairon-* 2>/dev/null | wc -l)

gum style --foreground 46 "✓ Installed $INSTALLED_COUNT Tairon scripts"

# Add ~/.local/bin to PATH if not already there
if ! grep -q "\.local/bin" ~/.bashrc 2>/dev/null; then
    echo "" >> ~/.bashrc
    echo "# Tairon scripts" >> ~/.bashrc
    echo "export PATH=\"\$HOME/.local/bin:\$PATH\"" >> ~/.bashrc
    gum style --foreground 46 "✓ Added ~/.local/bin to PATH"
else
    gum style --foreground 244 "~/.local/bin already in PATH"
fi

echo ""
gum style --foreground 212 "Tairon utilities installed!"
echo ""
gum style --foreground 226 "Available commands (tairon-*):"
ls "$TARGET_DIR"/tairon-* | sed 's|.*/||' | sed 's|tairon-|  - tairon|'
